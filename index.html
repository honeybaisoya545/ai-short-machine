<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Shorts Machine</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #0f172a;
      color: white;
      text-align: center;
      padding: 50px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    button {
      background: #10b981;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px;
    }
    input {
      padding: 10px;
      width: 70%;
      border-radius: 8px;
      border: none;
      margin: 10px;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      background: #1e293b;
      margin: 5px auto;
      padding: 10px;
      border-radius: 8px;
      max-width: 600px;
      text-align: left;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ü§ñ AI Shorts Machine</h1>
    <p>Add any video link. AI will make shorts automatically.</p>
    
    <input type="text" id="channelLink" placeholder="Paste YouTube, Facebook, TikTok link"/>
    <button onclick="addChannel()">Add Channel</button>

    <button onclick="toggleMachine()">AI Machine: OFF</button>
    <button onclick="testWithSampleVideo()">Test Sample Video</button>

    <h2>Your Channels</h2>
    <ul id="channelList"></ul>
  </div>

  <script>
    function addChannel() {
      const link = document.getElementById("channelLink").value.trim();
      if (!link) return alert("Please enter a link");

      let platform = "Other";
      let icon = "üåê";

      if (link.includes("youtube.com") || link.includes("youtu.be")) {
        platform = "YouTube";
        icon = "üì∫";
      } else if (link.includes("facebook.com")) {
        platform = "Facebook";
        icon = "üìò";
      } else if (link.includes("tiktok.com")) {
        platform = "TikTok";
        icon = "üéµ";
      }

      const list = document.getElementById("channelList");
      const li = document.createElement("li");
      li.innerHTML = `<strong>${icon} ${platform}</strong>: ${link.substring(0, 40)}...`;
      list.appendChild(li);
      document.getElementById("channelLink").value = "";
    }

    // YouTube API Integration
    let isMachineOn = false;
    let youtubeApiKey = "AIzaSyCi1owTgpghGwR6a4sztcYNFXZg7EDNjos"; // Your real API key

    function toggleMachine() {
      isMachineOn = !isMachineOn;
      const button = document.querySelector('button[onclick="toggleMachine()"]');
      
      if (isMachineOn) {
        button.textContent = "AI Machine: ON";
        button.style.background = "#10b981";
        startCheckingVideos();
      } else {
        button.textContent = "AI Machine: OFF";
        button.style.background = "#10b981";
      }
    }

    function startCheckingVideos() {
      if (!isMachineOn) return;
      
      alert("ü§ñ AI Machine is now checking for new videos...");
      
      // Example: Check CarryMinati's channel
      checkNewVideo("UCXRlZiA3R9cFv6au5Tq78Rw");
    }

    // Smart Clip Processing Logic - Step 5.1
    function calculateShortsFromVideo(totalDuration, targetDuration = 65) {
      const fullClips = Math.floor(totalDuration / targetDuration);
      const leftoverTime = totalDuration % targetDuration;
      
      let finalClips = fullClips;
      let lastClipDuration = targetDuration;
      
      if (leftoverTime > 10) {
        if (fullClips > 0) {
          const extraTimePerClip = Math.min(5, Math.floor(leftoverTime / Math.min(3, fullClips)));
          lastClipDuration = targetDuration + (leftoverTime - (extraTimePerClip * (fullClips - 1)));
        } else {
          lastClipDuration = leftoverTime;
        }
      }
      
      return {
        totalShorts: fullClips > 0 ? fullClips : 1,
        lastClipDuration: lastClipDuration,
        leftoverTime: leftoverTime
      };
    }

    // Helper function to convert ISO 8601 duration to seconds
    function parseISO8601Duration(duration) {
      const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
      const hours = parseInt(match[1]) || 0;
      const minutes = parseInt(match[2]) || 0;
      const seconds = parseInt(match[3]) || 0;
      return hours * 3600 + minutes * 60 + seconds;
    }

    // Test function with a known video (10 minutes)
    function testWithSampleVideo() {
      const sampleDuration = 600; // 10 minutes = 600 seconds
      const result = calculateShortsFromVideo(sampleDuration);
      
      alert(`üß™ Sample Video Test:
Duration: 10:00 (600 seconds)
Target Short: 65 seconds
Full Shorts: ${result.totalShorts}
Last Short: ${result.lastClipDuration} seconds
Leftover: ${result.leftoverTime} seconds`);
    }

    // Enhanced Video Detection - Step 5.2
    async function checkNewVideo(channelId) {
      try {
        // Get 3 most recent videos instead of just 1
        const response = await fetch(
          `https://www.googleapis.com/youtube/v3/search?order=date&part=snippet,id&channelId=${channelId}&maxResults=3&key=${youtubeApiKey}`
        );
        const data = await response.json();
        
        if (data.items && data.items.length > 0) {
          let message = "üÜï Recent videos detected:\n\n";
          
          // Check first 3 videos
          for(let i = 0; i < Math.min(3, data.items.length); i++) {
            const video = data.items[i];
            const videoId = video.id.videoId;
            const title = video.snippet.title;
            
            // Get video duration
            const durationResponse = await fetch(
              `https://www.googleapis.com/youtube/v3/videos?id=${videoId}&part=contentDetails&key=${youtubeApiKey}`
            );
            const durationData = await durationResponse.json();
            
            if (durationData.items && durationData.items.length > 0) {
              const durationISO = durationData.items[0].contentDetails.duration;
              const durationSeconds = parseISO8601Duration(durationISO);
              
              const clipInfo = calculateShortsFromVideo(durationSeconds);
              
              // Ask user if they want to process this video
              const userChoice = confirm(`üÜï New video detected!
Title: ${title}
Duration: ${Math.floor(durationSeconds/60)}:${String(durationSeconds%60).padStart(2,'0')}
Shorts Possible: ${clipInfo.totalShorts}

Click OK to process this video into shorts, Cancel to skip.`);

              if (userChoice) {
                processVideoCompletely(videoId, title);
                break; // Process only the first selected video for now
              }

              message += `${i+1}. ${title}
Duration: ${Math.floor(durationSeconds/60)}:${String(durationSeconds%60).padStart(2,'0')}
Shorts: ${clipInfo.totalShorts} clips (${clipInfo.lastClipDuration}s last)
\n`;
            } else {
              message += `${i+1}. ${title} (Duration: N/A)\n\n`;
            }
          }
          
          // Only show list if no video was selected for processing
          if (!message.includes("processVideoCompletely")) {
             alert(message);
          }
        } else {
          alert("No recent videos found.");
        }
      } catch (error) {
        alert("Error checking for videos. Make sure API key is correct.");
      }
    }


    // Step 6: Video Processing Functions

    // Function to simulate video processing (since we can't do real processing in browser)
    function processVideoToShorts(videoId, duration, numberOfShorts) {
      alert(`üé¨ Starting video processing...
      
Video ID: ${videoId}
Duration: ${duration} seconds
Shorts to create: ${numberOfShorts}

‚ö†Ô∏è Note: Real video processing requires backend/server.
This is a simulation for now.`);

      // Simulate processing time
      setTimeout(() => {
        alert(`‚úÖ Video processing complete!
        
Created ${numberOfShorts} shorts from video.
Each short is 65 seconds long (9:16 ratio).
Added automatic captions and basic effects.`);
      }, 3000);
    }

    // Function to generate video editing links
    function getVideoEditingLinks(videoId) {
      const links = {
        "Online Video Cutter": `https://online-video-cutter.com/?url=https://youtube.com/watch?v=${videoId}`,
        "Clideo": `https://clideo.com/cut-video?url=https://youtube.com/watch?v=${videoId}`,
        "VidLouder": `https://www.vidlouder.com/video-editor/?url=https://youtube.com/watch?v=${videoId}`
      };
      
      let message = "üîß Video Editing Tools:\n\n";
      for (const [name, url] of Object.entries(links)) {
        message += `${name}: ${url}\n\n`;
      }
      
      return message;
    }

    // Enhanced function to process a video completely
    async function processVideoCompletely(videoId, title) {
      try {
        // Get video duration
        const durationResponse = await fetch(
          `https://www.googleapis.com/youtube/v3/videos?id=${videoId}&part=contentDetails&key=${youtubeApiKey}`
        );
        const durationData = await durationResponse.json();
        
        if (durationData.items && durationData.items.length > 0) {
          const durationISO = durationData.items[0].contentDetails.duration;
          const durationSeconds = parseISO8601Duration(durationISO);
          
          const clipInfo = calculateShortsFromVideo(durationSeconds);
          
          const result = `üìπ Video Processing Ready:
Title: ${title}
Duration: ${Math.floor(durationSeconds/60)}:${String(durationSeconds%60).padStart(2,'0')}
Shorts: ${clipInfo.totalShorts} clips
Last Clip: ${clipInfo.lastClipDuration} seconds

Choose an option:
1. Simulate Processing (Demo)
2. Get Editing Tool Links
3. Cancel`;

          const choice = confirm(result + "\n\nClick OK for Demo, Cancel for Editing Links");
          
          if (choice) {
            // Simulate processing
            processVideoToShorts(videoId, durationSeconds, clipInfo.totalShorts);
          } else {
            // Show editing tool links
            const links = getVideoEditingLinks(videoId);
            alert(links);
          }
        }
      } catch (error) {
        alert("Error processing video: " + error.message);
      }
    }
  </script>
</body>
</html>
